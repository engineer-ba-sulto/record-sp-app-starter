# 新規テーブル追加時のレビュー観点チェックリスト

## 基本設計

### 命名規約

- [ ] テーブル名がスネークケース（例: `user_profiles`）
- [ ] 列名がスネークケース（例: `user_id`, `created_at`）
- [ ] 主キーが `id` として設定されている
- [ ] 外部キーが `<table>_id` 形式（例: `user_id`）

### 必須カラム

- [ ] `id` カラム（UUID、主キー、`gen_random_uuid()` デフォルト）
- [ ] `created_at` カラム（`timestamptz`、`now()` デフォルト）
- [ ] `updated_at` カラム（`timestamptz`、`now()` デフォルト）

## セキュリティ（RLS）

### 所有者カラム

- [ ] `user_id` カラムが設定されている（RLS 用）
- [ ] `user_id` カラムが `NOT NULL` 制約付き
- [ ] `user_id` カラムにインデックスが設定されている

### RLS ポリシー（後続チケットで実装）

- [ ] RLS が有効化される予定
- [ ] 適切なポリシーが設計される予定
- [ ] `auth.uid() = user_id` 形式のポリシーが使用される予定

## パフォーマンス

### インデックス

- [ ] `user_id` カラムにインデックスが設定されている
- [ ] 高頻度クエリの WHERE 句に使用されるカラムにインデックスが設定されている
- [ ] 過剰な複合インデックスがない

### 制約

- [ ] 必要な外部キー制約が設定されている
- [ ] ユニーク制約が必要なカラムに設定されている
- [ ] 複合ユニーク制約が適切に設定されている

## データ整合性

### 外部キー

- [ ] 参照整合性を保つための外部キー制約が設定されている
- [ ] カスケード削除の設定が適切（通常は `NO ACTION` を推奨）

### データ型

- [ ] 適切なデータ型が選択されている
- [ ] 文字列長制限が適切に設定されている
- [ ] 数値型の精度が適切に設定されている

## Drizzle 設定

### スキーマ定義

- [ ] Drizzle スキーマで export されている
- [ ] 命名規約に従ったカラム名が使用されている
- [ ] 適切な Drizzle 型が使用されている

### マイグレーション

- [ ] `drizzle-kit generate` で SQL が正常に生成される
- [ ] 生成された SQL が Postgres で実行可能
- [ ] マイグレーション履歴が適切に管理される

## 運用・保守

### ドキュメント

- [ ] テーブルの目的と用途が文書化されている
- [ ] 重要なビジネスルールが文書化されている
- [ ] パフォーマンスに関する注意事項が文書化されている

### テスト

- [ ] スキーマのテストケースが準備されている
- [ ] RLS ポリシーのテストケースが準備されている
- [ ] パフォーマンステストが考慮されている

## セキュリティレビュー

### アクセス制御

- [ ] 適切な RLS ポリシーが設計されている
- [ ] 認証・認可の要件が明確になっている
- [ ] 機密データの取り扱いが適切に設計されている

### データ保護

- [ ] 個人情報の取り扱いが適切に設計されている
- [ ] データの暗号化要件が考慮されている
- [ ] 監査ログの要件が考慮されている

## 最終確認

- [ ] チームメンバーによるレビューが完了している
- [ ] セキュリティレビューが完了している
- [ ] パフォーマンスレビューが完了している
- [ ] 本番環境への適用計画が策定されている
